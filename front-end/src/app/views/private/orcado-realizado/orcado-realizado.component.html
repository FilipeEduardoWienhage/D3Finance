<div class="min-h-screen flex flex-col bg-[#1e1e1e]">
    <app-header-system></app-header-system>

    <div class="flex flex-row flex-grow px-4 gap-4">
        <div class="flex-shrink-0">
            <app-nav-bar-system></app-nav-bar-system>
        </div>

        <div class="flex-grow p-4">
            <p-toast></p-toast>
            
            <!-- T√≠tulo -->
            <div class="mb-6">
                <h1 class="text-3xl font-bold text-white mb-2">Or√ßado x Realizado</h1>
                <p class="text-gray-400">
                    An√°lise comparativa de receitas e despesas: valores or√ßados versus valores efetivamente realizados
                </p>
            </div>


            <!-- ========== RECEITAS ========== -->
            <p-card class="mb-8">
                <ng-template pTemplate="header">
                    <div class="p-4 bg-gradient-to-r from-green-600 to-green-500">
                        <h2 class="text-2xl font-bold text-white mb-2">üí∞ Receitas - Or√ßado x Realizado</h2>
                        <p class="text-sm text-green-100">
                            <strong>Or√ßado:</strong> Contas a receber cadastradas ‚Ä¢ 
                            <strong>Realizado:</strong> Contas a receber pagas + Receitas manuais
                        </p>
                    </div>
                </ng-template>

                <!-- Filtros de Receitas -->
                <div class="mb-6 p-4 bg-gray-800 rounded-lg">
                    <h3 class="text-sm font-semibold mb-3 text-gray-300">üîç Filtros de Receitas</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-400">Ano</label>
                            <input 
                                type="number" 
                                pInputText 
                                [(ngModel)]="anoReceitas" 
                                class="w-full"
                                [min]="2000"
                                [max]="2100"
                            />
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-400">M√™s</label>
                            <p-dropdown 
                                [options]="mesesOpcoes" 
                                [(ngModel)]="mesReceitas" 
                                placeholder="Todos"
                                [showClear]="true"
                                styleClass="w-full">
                            </p-dropdown>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-400">Categoria</label>
                            <p-dropdown 
                                [options]="categoriasReceitasOpcoes" 
                                [(ngModel)]="categoriaReceitas" 
                                placeholder="Todas"
                                [showClear]="true"
                                [filter]="true"
                                filterPlaceholder="Buscar"
                                styleClass="w-full">
                            </p-dropdown>
                        </div>
                        
                        <div class="flex gap-2">
                            <p-button 
                                label="Filtrar" 
                                icon="pi pi-filter" 
                                (onClick)="filtrarDadosReceitas()"
                                severity="success">
                            </p-button>
                            <p-button 
                                label="Limpar" 
                                icon="pi pi-times" 
                                (onClick)="limparFiltrosReceitas()"
                                severity="secondary"
                                [outlined]="true">
                            </p-button>
                        </div>
                    </div>
                </div>

                <!-- Cards de Totais - Receitas -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" *ngIf="dadosRelatorioReceitas">
                    <p-card>
                        <div class="text-center">
                            <div class="text-sm text-gray-400 mb-2">Total Or√ßado</div>
                            <div class="text-2xl font-bold text-blue-500">
                                {{ dadosRelatorioReceitas.total_orcado | currency:'BRL':'symbol':'1.2-2' }}
                            </div>
                        </div>
                    </p-card>
                    
                    <p-card>
                        <div class="text-center">
                            <div class="text-sm text-gray-400 mb-2">Total Realizado</div>
                            <div class="text-2xl font-bold text-green-500">
                                {{ dadosRelatorioReceitas.total_realizado | currency:'BRL':'symbol':'1.2-2' }}
                            </div>
                        </div>
                    </p-card>
                    
                    <p-card>
                        <div class="text-center">
                            <div class="text-sm text-gray-400 mb-2">Diferen√ßa</div>
                            <div class="text-2xl font-bold" 
                                 [ngClass]="{
                                    'text-green-500': dadosRelatorioReceitas.total_diferenca >= 0,
                                    'text-red-500': dadosRelatorioReceitas.total_diferenca < 0
                                 }">
                                {{ dadosRelatorioReceitas.total_diferenca | currency:'BRL':'symbol':'1.2-2' }}
                            </div>
                            <div class="text-xs mt-1" 
                                 [ngClass]="{
                                    'text-green-400': dadosRelatorioReceitas.total_diferenca >= 0,
                                    'text-red-400': dadosRelatorioReceitas.total_diferenca < 0
                                 }">
                                {{ dadosRelatorioReceitas.total_diferenca >= 0 ? 'Super√°vit' : 'D√©ficit' }}
                            </div>
                        </div>
                    </p-card>
                </div>

                <!-- Gr√°fico Receitas -->
                <div class="mb-4">
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold text-white">
                            <span *ngIf="mesReceitas">{{ mesesOpcoes[mesReceitas].label }} de </span>
                            <span *ngIf="!mesReceitas">Ano Completo - </span>
                            {{ anoReceitas }}
                            <span *ngIf="categoriaReceitas" class="text-sm text-green-400 ml-2">({{ categoriaReceitas }})</span>
                        </h3>
                    </div>
                    <div class="h-[500px]">
                        <p-chart 
                            type="bar" 
                            [data]="dataReceitas" 
                            [options]="optionsReceitas" 
                            class="h-full">
                        </p-chart>
                    </div>
                </div>
            </p-card>

            <!-- ========== DESPESAS ========== -->
            <p-card class="mb-6">
                <ng-template pTemplate="header">
                    <div class="p-4 bg-gradient-to-r from-red-600 to-red-500">
                        <h2 class="text-2xl font-bold text-white mb-2">üí∏ Despesas - Or√ßado x Realizado</h2>
                        <p class="text-sm text-red-100">
                            <strong>Or√ßado:</strong> Contas a pagar cadastradas ‚Ä¢ 
                            <strong>Realizado:</strong> Contas a pagar pagas + Despesas manuais
                        </p>
                    </div>
                </ng-template>

                <!-- Filtros de Despesas -->
                <div class="mb-6 p-4 bg-gray-800 rounded-lg">
                    <h3 class="text-sm font-semibold mb-3 text-gray-300">üîç Filtros de Despesas</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-400">Ano</label>
                            <input 
                                type="number" 
                                pInputText 
                                [(ngModel)]="anoDespesas" 
                                class="w-full"
                                [min]="2000"
                                [max]="2100"
                            />
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-400">M√™s</label>
                            <p-dropdown 
                                [options]="mesesOpcoes" 
                                [(ngModel)]="mesDespesas" 
                                placeholder="Todos"
                                [showClear]="true"
                                styleClass="w-full">
                            </p-dropdown>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-400">Categoria</label>
                            <p-dropdown 
                                [options]="categoriasDespesasOpcoes" 
                                [(ngModel)]="categoriaDespesas" 
                                placeholder="Todas"
                                [showClear]="true"
                                [filter]="true"
                                filterPlaceholder="Buscar"
                                styleClass="w-full">
                            </p-dropdown>
                        </div>
                        
                        <div class="flex gap-2">
                            <p-button 
                                label="Filtrar" 
                                icon="pi pi-filter" 
                                (onClick)="filtrarDadosDespesas()"
                                severity="danger">
                            </p-button>
                            <p-button 
                                label="Limpar" 
                                icon="pi pi-times" 
                                (onClick)="limparFiltrosDespesas()"
                                severity="secondary"
                                [outlined]="true">
                            </p-button>
                        </div>
                    </div>
                </div>

                <!-- Cards de Totais - Despesas -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" *ngIf="dadosRelatorioDespesas">
                    <p-card>
                        <div class="text-center">
                            <div class="text-sm text-gray-400 mb-2">Total Or√ßado</div>
                            <div class="text-2xl font-bold text-gray-400">
                                {{ dadosRelatorioDespesas.total_orcado | currency:'BRL':'symbol':'1.2-2' }}
                            </div>
                        </div>
                    </p-card>
                    
                    <p-card>
                        <div class="text-center">
                            <div class="text-sm text-gray-400 mb-2">Total Realizado</div>
                            <div class="text-2xl font-bold text-red-500">
                                {{ dadosRelatorioDespesas.total_realizado | currency:'BRL':'symbol':'1.2-2' }}
                            </div>
                        </div>
                    </p-card>
                    
                    <p-card>
                        <div class="text-center">
                            <div class="text-sm text-gray-400 mb-2">Diferen√ßa</div>
                            <div class="text-2xl font-bold" 
                                 [ngClass]="{
                                    'text-green-500': dadosRelatorioDespesas.total_diferenca <= 0,
                                    'text-red-500': dadosRelatorioDespesas.total_diferenca > 0
                                 }">
                                {{ dadosRelatorioDespesas.total_diferenca | currency:'BRL':'symbol':'1.2-2' }}
                            </div>
                            <div class="text-xs mt-1" 
                                 [ngClass]="{
                                    'text-green-400': dadosRelatorioDespesas.total_diferenca <= 0,
                                    'text-red-400': dadosRelatorioDespesas.total_diferenca > 0
                                 }">
                                {{ dadosRelatorioDespesas.total_diferenca <= 0 ? 'Economia' : 'Excesso' }}
                            </div>
                        </div>
                    </p-card>
                </div>

                <!-- Gr√°fico Despesas -->
                <div class="mb-4">
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold text-white">
                            <span *ngIf="mesDespesas">{{ mesesOpcoes[mesDespesas].label }} de </span>
                            <span *ngIf="!mesDespesas">Ano Completo - </span>
                            {{ anoDespesas }}
                            <span *ngIf="categoriaDespesas" class="text-sm text-red-400 ml-2">({{ categoriaDespesas }})</span>
                        </h3>
                    </div>
                    <div class="h-[500px]">
                        <p-chart 
                            type="bar" 
                            [data]="dataDespesas" 
                            [options]="optionsDespesas" 
                            class="h-full">
                        </p-chart>
                    </div>
                </div>
            </p-card>
        </div>
    </div>
    
    <app-footer class="mt-auto"></app-footer>
</div>

